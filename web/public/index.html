<html>

<head>

<script src="jquery-1.4.2.min.js"></script>
<script type="text/javascript">

var ws;

start = function(){

  if (!("WebSocket" in window))
  {
    debug("You have no web sockets.");
    return;
  }

  debug("Trying to connect.");

  ws = new WebSocket("ws://speedyscrabble.local:83/play");

  ws.onopen = function() {
    // Web Socket is connected. You can send data by send() method.
    debug("Connected!");
  };

  run = function() {
    var val=$("#i1").val(); // read the entry
    $("#i1").val("");       // and clear it
    ws.send(val);           // tell erlang
    return true;            // must do this
  };

  ws.onmessage = function (evt)
  {
    var command = evt.data[0]
    var data = evt.data.slice(1)
    if (command=='t')
    {
        $("#clock").html(data);
    }
    else if (command=='c')
    {
        cm = document.getElementById("chat_messages");
        cm.innerHTML += "<div class=\"chat_message\">"+data+"</div>";
        cm.scrollTop = cm.scrollHeight;
    }
  };

  ws.onclose = function()
  {
    debug("Socket closed.");
  };
}

function debug(str){
  document.getElementById("debug").innerHTML += "<div>"+str+"</div>";
};

function sendChat()
{
  var chat_input = document.getElementById('chat_input');
  var val = chat_input.value;
  if (val!='')
  {
    ws.send(val);
    chat_input.value = '';
  }
}


$(document).ready(start);

</script>

</head>

<body>

<div id="debug"></div>

<div id="clock">I am a clock</div>

<div id="chat_messages" style="border:1px solid black;height:200px;overflow:scroll;"></div>

<div>
  <input id="chat_input" type="text" value="" style="width:300px;"
    onKeyPress="if(event.which==13){sendChat();return false}return true"/>
  <input type="submit" onClick="sendChat();return false"/>
</div>


</body>

</html>
