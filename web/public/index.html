<html>
<head>
<script src="jquery-1.4.2.min.js"></script>
<script type="text/javascript">

var ws;

start = function(){

  if (!("WebSocket" in window))
  {
    status("You have no web sockets.");
    return;
  }

  status("Trying to connect.");

  ws = new WebSocket("ws://speedyscrabble.local:83/play");

  ws.onopen = function() {
    // Web Socket is connected. You can send data by send() method.
    status("Connected.");
  };

  run = function() {
    var val=$("#i1").val(); // read the entry
    $("#i1").val("");       // and clear it
    ws.send(val);           // tell erlang
    return true;            // must do this
  };

  ws.onmessage = function (evt)
  {
    var command = evt.data[0]
    var data = evt.data.slice(1)
    if (command=='t')
    {
        $("#clock").html(data);
    }
    else if (command=='c')
    {
        addChatElement("<div class=\"chat_message\">"+data+"</div>");
    }
  };

  ws.onclose = function()
  {
    status("Connection closed.");
  };
}

function status(str)
{
    addChatElement("<div class=\"status_message\">"+str+"</div>");
};

function addChatElement(str)
{
  cm = document.getElementById("chat_messages");
  cm.innerHTML += str;
  cm.scrollTop = cm.scrollHeight+30;
}

function sendChat()
{
  var chat_input = document.getElementById('chat_input');
  var val = chat_input.value;
  if (val!='')
  {
    ws.send(val);
    chat_input.value = '';
  }
}


$(document).ready(start);

</script>
<style type="text/css">
#chat_messages
{
    border:1px solid black;
    width:200px;
    height:200px;
    overflow-y:scroll;
}

#chat_input
{
    width: 200px;
}

.status_message
{
    font-style: italic;
}
</style>
</head>

<body>

<div id="sidebar">
  <div id="chat_messages"></div>
  <div>
    <input id="chat_input" type="text" value=""
      onKeyPress="if(event.which==13){sendChat();return false}return true"/>
  </div>
</div>

<div id="main">
  Insert fun game here
</div>

</body>

</html>
