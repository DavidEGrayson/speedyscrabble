<html>

<head>

<script src="jquery-1.4.2.min.js"></script>
<script type="text/javascript">

var ws;

start = function(){

  if (!("WebSocket" in window))
  {
    debug("You have no web sockets.");
    return;
  }

  debug("Trying to connect.");

  ws = new WebSocket("ws://speedyscrabble.local:83/play");

  ws.onopen = function() {
    // Web Socket is connected. You can send data by send() method.
    debug("Connected!");
  };

  run = function() {
    var val=$("#i1").val(); // read the entry
    $("#i1").val("");       // and clear it
    ws.send(val);           // tell erlang
    return true;            // must do this
  };

  ws.onmessage = function (evt)
  {
    var command = evt.data[0]
    var data = evt.data.slice(1)
    if (command=='t')
    {
        $("#clock").html(data);
    }
    else if (command=='c')
    {
        $("#chat").append("<p>"+data+"</p>")
    }
  };

  ws.onclose = function()
  {
    debug("Socket closed.");
  };
}

function debug(str){
  $("#debug").append("<p>" +  str);
};


$(document).ready(start);

</script>

</head>

<body>

<div id="debug"></div>

<div id="clock">I am a clock</div>

<div id="chat" style="border:1px solid black;"></div>

<input id="chat_input" type="text" value="yo"/>

<input type="submit" onclick="val=document.getElementById('chat_input').value;ws.send(val);return false"/>

</body>

</html>
